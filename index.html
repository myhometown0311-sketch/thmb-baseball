<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Thumb Baseball - 修正版</title>
<style> /* スタイルは前回と同じ、省略 */ </style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
</head>
<body> /* HTML構造は前回と同じ、省略 */ 

<script>
// グローバル変数（前回と同じ）

async function tryStart(hand) {
  // 前回と同じ
  try {
    // ... stream取得
    loadAI();
  } catch (err) {
    console.error("Camera error:", err); // ★ログ追加
    showError("カメラエラー: " + err.message);
    startTouchMode(); // 自動タッチモード
  }
}

function loadAI() {
  try {
    hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({
      maxNumHands: 1,
      modelComplexity: 0,
      minDetectionConfidence: 0.3, // ★下げて検出しやすく
      minTrackingConfidence: 0.3 // ★下げて
    });
    hands.onResults(onResults);

    camera = new Camera(videoElement, {
      onFrame: async () => {
        console.log("Sending frame"); // ★デバッグログ
        await hands.send({image: videoElement});
      },
      width: 320, height: 240 // ★モバイル向けに解像度下げて軽く
    });
    camera.start();
    console.log("Camera started");

    document.getElementById('ui-layer').style.display = 'none';
    isPlaying = true;
    setupGame();
  } catch(e) {
    console.error("AI load error:", e);
    showError("AIエラー: " + e);
    startTouchMode();
  }
}

function onResults(results) {
  console.log("Results:", results.multiHandLandmarks); // ★検出ログ
  // 前回と同じ
}

// draw()でカメラ映像をデバッグ表示（一時的に）
function draw() {
  background(34, 139, 34);
  if (videoElement.readyState >= 2) {
    image(videoElement, 0, 0, width/4, height/4); // ★左上に小さく映像表示（デバッグ用、正常なら削除）
  }
  // 以降同じ
}

// 他の関数は前回と同じ
</script>
</body>
</html>
