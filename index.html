<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Thumb Rehab Baseball</title>
<style>
  /* --- åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« --- */
  body {
    margin: 0; padding: 0; overflow: hidden;
    background-color: #111; font-family: "Hiragino Kaku Gothic ProN", sans-serif;
    touch-action: none; color: white;
  }

  /* ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼ˆæœ€èƒŒé¢ï¼‰ */
  canvas {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 1;
  }

  /* UIãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆæœ€å‰é¢ï¼‰ */
  #ui-layer {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 100;
    pointer-events: none; /* UIã®éš™é–“ã¯ã‚¿ãƒƒãƒ—é€é */
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }

  /* å„ç”»é¢ãƒ‘ãƒãƒ« */
  .screen {
    position: absolute; width: 90%; max-width: 400px;
    background: rgba(0, 0, 0, 0.85);
    border: 2px solid #444; border-radius: 12px;
    padding: 20px; text-align: center;
    pointer-events: auto; /* ãƒ‘ãƒãƒ«å†…ã¯ã‚¿ãƒƒãƒ—æœ‰åŠ¹ */
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    display: none; /* JSã§åˆ¶å¾¡ */
  }
  
  /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç”»é¢ã‚’è¡¨ç¤º */
  .screen.active { display: block; }

  h1 { color: #ffcc00; margin: 0 0 10px 0; font-size: 24px; }
  h2 { color: #4db8ff; margin: 0 0 15px 0; font-size: 20px; }
  p { font-size: 14px; line-height: 1.6; color: #ddd; margin-bottom: 20px; }

  .btn {
    display: block; width: 100%; margin: 10px 0; padding: 15px;
    font-size: 18px; font-weight: bold; color: #000;
    background: linear-gradient(to bottom, #ffeb3b, #fbc02d);
    border: none; border-radius: 30px; cursor: pointer;
  }
  .btn:active { transform: scale(0.98); }
  .btn.secondary { background: #ddd; color: #333; }

  /* å¯å‹•åŸŸè¡¨ç¤ºï¼ˆHUDï¼‰ */
  #rom-display {
    position: fixed; top: 10px; right: 10px;
    background: rgba(0,0,0,0.6); padding: 8px 12px;
    border-radius: 8px; font-size: 14px; font-family: monospace;
    border: 1px solid #4db8ff; color: #4db8ff;
    z-index: 50; display: none;
  }

  /* ãƒ©ã‚¤ãƒ•è¡¨ç¤º */
  #life-display {
    position: fixed; top: 10px; left: 10px;
    font-size: 24px; z-index: 50; display: none;
  }

  video { display: none; }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
</head>
<body>

<div id="life-display">â¤ï¸â¤ï¸â¤ï¸</div>
<div id="rom-display">ROM: 0 mm</div>

<div id="ui-layer">

  <div id="screen-menu" class="screen active">
    <h1>Thumb Rehab</h1>
    <p>è¦ªæŒ‡ã®å¯å‹•åŸŸãƒªãƒãƒ“ãƒªãƒ»ã‚¹ãƒˆãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ</p>
    <p style="font-size:12px; color:#aaa;">â€»ã‚«ãƒ¡ãƒ©ã‚’è¨±å¯ã—ã¦ãã ã•ã„</p>
    <button class="btn" onclick="startGameFlow('right')">å³æ‰‹ã§ãƒ—ãƒ¬ã‚¤ âœ‹</button>
    <button class="btn" onclick="startGameFlow('left')">å·¦æ‰‹ã§ãƒ—ãƒ¬ã‚¤ âœ‹</button>
  </div>

  <div id="screen-calibration" class="screen">
    <h2>å¯å‹•åŸŸã®æ¸¬å®š</h2>
    <p id="calib-inst">ã¾ãšã¯ã€Œè¦ªæŒ‡ã‚’é–‰ã˜ã¦ï¼ˆã‚°ãƒ¼ï¼‰ã€<br>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
    <div style="font-size:30px; margin:10px; color:#4db8ff;" id="calib-val">0 mm</div>
    <button id="btn-calib" class="btn" onclick="nextCalibrationStep()">é–‰ã˜ãŸçŠ¶æ…‹ã§è¨˜éŒ²</button>
  </div>

  <div id="screen-gameover" class="screen">
    <h1 style="color:#ff5555;">GAME OVER</h1>
    <p id="result-score">Score: 0</p>
    <button class="btn" onclick="location.reload()">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
  </div>

</div>

<video id="input_video" playsinline webkit-playsinline muted autoplay></video>

<script>
// --- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ---
const videoElement = document.getElementById('input_video');
let hands;
let camera;
let isRightHand = true;

// ã‚¢ãƒ—ãƒªçŠ¶æ…‹ç®¡ç†
// 0:Menu, 1:Calib(Close), 2:Calib(Open), 3:Game, 4:GameOver
let appState = 0; 

// æ‰‹ã®èªè­˜ãƒ‡ãƒ¼ã‚¿
let landmarks = null;
let handScale = 100; // æ‰‹ã®ã²ã‚‰ã‚µã‚¤ã‚ºï¼ˆåŸºæº–ï¼‰
let thumbDist = 0;   // ç¾åœ¨ã®è¦ªæŒ‡è·é›¢
let thumbDistMm = 0; // æ¨å®šãƒŸãƒªãƒ¡ãƒ¼ãƒˆãƒ«

// ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨
let distClose = 0;
let distOpen = 0;

// ã‚²ãƒ¼ãƒ å¤‰æ•°
let panels = [];
let balls = [];
let score = 0;
let lives = 3;
let batSwing = 0; // 0.0 ~ 1.0 (ã‚¹ã‚¤ãƒ³ã‚°é€²æ—)
let lastBatSwing = 0;
let isSwinging = false;
let frameCountVal = 0;

// --- åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼ ---
async function startGameFlow(hand) {
  isRightHand = (hand === 'right');
  
  // ç”»é¢é·ç§» -> ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æº–å‚™
  switchScreen('screen-calibration');
  
  // ã‚«ãƒ¡ãƒ©èµ·å‹•
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      audio: false,
      video: { facingMode: 'user', width: { ideal: 640 }, height: { ideal: 480 } }
    });
    videoElement.srcObject = stream;
    await videoElement.play();
    
    initMediaPipe();
  } catch(e) {
    alert("ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼: " + e.name + "\nhttpsæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
  }
}

function initMediaPipe() {
  hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
  hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 0, // è»½é‡ç‰ˆ
    minDetectionConfidence: 0.5,
    minTrackingConfidence: 0.5
  });
  hands.onResults(onResults);
  
  // æ‰‹å‹•ãƒ«ãƒ¼ãƒ—é–‹å§‹
  loopAI();
}

async function loopAI() {
  if(videoElement.readyState >= 2) {
    await hands.send({image: videoElement});
  }
  requestAnimationFrame(loopAI);
}

function onResults(results) {
  if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    landmarks = results.multiHandLandmarks[0];
    calculateHandData();
  } else {
    landmarks = null;
  }
}

// è¦ªæŒ‡ãƒ‡ãƒ¼ã‚¿ã®è¨ˆç®—ï¼ˆãƒŸãƒªãƒ¡ãƒ¼ãƒˆãƒ«æ›ç®—ãªã©ï¼‰
function calculateHandData() {
  if(!landmarks) return;
  
  // åº§æ¨™å¤‰æ›ãƒ˜ãƒ«ãƒ‘ãƒ¼
  const w = width; const h = height;
  const getP = (i) => ({x: (1-landmarks[i].x)*w, y: landmarks[i].y*h}); // å·¦å³åè»¢
  
  const wrist = getP(0);
  const indexMCP = getP(5); // äººå·®ã—æŒ‡ä»˜ã‘æ ¹
  const thumbTip = getP(4); // è¦ªæŒ‡å…ˆ

  // 1. æ‰‹ã®ã‚µã‚¤ã‚ºåŸºæº–ï¼ˆæ‰‹é¦–ã€œäººå·®ã—æŒ‡ä»˜ã‘æ ¹ï¼‰ã‚’ç´„10cm(100mm)ã¨ä»®å®šã—ã¦ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—
  let pxHandSize = dist(wrist.x, wrist.y, indexMCP.x, indexMCP.y);
  let mmPerPx = 100 / pxHandSize; // ãƒ”ã‚¯ã‚»ãƒ« -> mm å¤‰æ›ä¿‚æ•°

  // 2. è¦ªæŒ‡ã®é–‹ãï¼ˆè¦ªæŒ‡å…ˆ ã€œ äººå·®ã—æŒ‡ä»˜ã‘æ ¹ã®è·é›¢ï¼‰
  thumbDist = dist(thumbTip.x, thumbTip.y, indexMCP.x, indexMCP.y);
  thumbDistMm = Math.floor(thumbDist * mmPerPx);

  // è¡¨ç¤ºæ›´æ–°
  const disp = document.getElementById('rom-display');
  const calibVal = document.getElementById('calib-val');
  
  if(appState === 3) { // ã‚²ãƒ¼ãƒ ä¸­
    disp.style.display = 'block';
    disp.innerText = `å¯å‹•åŸŸ: ${thumbDistMm}mm`;
  }
  if(appState === 1 || appState === 2) { // ã‚­ãƒ£ãƒªãƒ–ä¸­
    calibVal.innerText = `${thumbDistMm} mm`;
  }
}

// --- ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡ ---
function nextCalibrationStep() {
  const info = document.getElementById('calib-inst');
  const btn = document.getElementById('btn-calib');

  if(appState === 0) { // åˆæœŸçŠ¶æ…‹ -> é–‰ã˜ã‚‹è¨ˆæ¸¬
    appState = 1;
  } else if (appState === 1) { // é–‰ã˜ã‚‹è¨˜éŒ² -> é–‹ãæŒ‡ç¤º
    distClose = thumbDist;
    appState = 2;
    info.innerHTML = "æ¬¡ã¯ã€Œè¦ªæŒ‡ã‚’æœ€å¤§ã¾ã§é–‹ã„ã¦ã€<br>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„";
    btn.innerText = "é–‹ã„ãŸçŠ¶æ…‹ã§è¨˜éŒ²";
  } else if (appState === 2) { // é–‹ãè¨˜éŒ² -> ã‚²ãƒ¼ãƒ é–‹å§‹
    distOpen = thumbDist;
    // ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ï¼ˆã‚ã¾ã‚Šå·®ãŒãªã„å ´åˆï¼‰
    if(distOpen - distClose < 10) {
      alert("å‹•ããŒå°ã•ã™ãã¾ã™ã€‚ã‚‚ã†å°‘ã—å¤§ããå‹•ã‹ã—ã¦å†è¨­å®šã—ã¦ãã ã•ã„ã€‚");
      appState = 1; distClose = 0; distOpen = 0;
      info.innerHTML = "ã¾ãšã¯ã€Œè¦ªæŒ‡ã‚’é–‰ã˜ã¦ï¼ˆã‚°ãƒ¼ï¼‰ã€<br>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„";
      btn.innerText = "é–‰ã˜ãŸçŠ¶æ…‹ã§è¨˜éŒ²";
      return;
    }
    appState = 3;
    switchScreen(null); // å…¨ç”»é¢æ¶ˆå»
    initGame();
  }
}

// --- ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ---
function initGame() {
  panels = [];
  balls = [];
  score = 0;
  lives = 3;
  updateLives();
  document.getElementById('life-display').style.display = 'block';

  // ãƒ‘ãƒãƒ«ç”Ÿæˆï¼ˆ3x3ï¼‰
  // 1-3:ä¸‹æ®µ, 4-6:ä¸­æ®µ, 7-9:ä¸Šæ®µ
  let pw = width * 0.1; 
  let ph = height * 0.1; 
  let startX = isRightHand ? width * 0.1 : width * 0.6; // ãƒ‘ãƒãƒ«ä½ç½®
  
  for(let row=0; row<3; row++) { // 0:ä¸‹, 1:ä¸­, 2:ä¸Š (IDé †ã®ãŸã‚é€†é…ç½®æ³¨æ„)
    for(let col=0; col<3; col++) {
      // row 0 -> ID 1,2,3 (Bottom)
      // row 1 -> ID 4,5,6 (Mid)
      // row 2 -> ID 7,8,9 (Top)
      // ç”»é¢ä¸Šã¯ä¸ŠãŒyå°ã€‚
      let py = height * 0.7 - (row * (ph + 10)); 
      let px = startX + col * (pw + 10);
      let id = (row * 3) + col + 1;
      panels.push({x: px, y: py, w: pw, h: ph, id: id, active: true});
    }
  }
}

// p5.js Setup & Draw
function setup() {
  let cvs = createCanvas(windowWidth, windowHeight);
  cvs.id('game-canvas');
}

function draw() {
  clear(); // é€æ˜èƒŒæ™¯ï¼ˆã‚«ãƒ¡ãƒ©ã¯CSSã§å¾Œã‚ã«è¦‹ãˆã¦ã„ã‚‹ã€ä»Šå›ã¯videoæç”»ã—ãªã„ï¼‰
  
  // ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’Canvasã«æç”»ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼é †ç®¡ç†ã®ãŸã‚ï¼‰
  if (videoElement.readyState >= 2) {
    push();
    translate(width, 0); scale(-1, 1);
    // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ç¶­æŒæç”»
    let vw = videoElement.videoWidth;
    let vh = videoElement.videoHeight;
    let scaleVal = max(width/vw, height/vh);
    let w = vw * scaleVal; let h = vh * scaleVal;
    image(videoElement, (width-w)/2, (height-h)/2, w, h);
    
    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆæš—ãã™ã‚‹ï¼‰
    fill(0, 100); noStroke(); rect(0,0,width,height);
    pop();
  }

  // çŠ¶æ…‹åˆ¥æç”»
  if(appState === 3) {
    runGameLoop();
  }
  
  // æ‰‹ã®éª¨æ ¼æç”»ï¼ˆå¸¸ã«è¡¨ç¤ºï¼‰
  if(landmarks) {
    drawHandSkeleton();
  }
}

function drawHandSkeleton() {
  const getP = (i) => ({x: (1-landmarks[i].x)*width, y: landmarks[i].y*height});
  
  // è¦ªæŒ‡ã¨äººå·®ã—æŒ‡ã®ãƒ©ã‚¤ãƒ³
  let p4 = getP(4); let p5 = getP(5);
  stroke(0, 255, 255); strokeWeight(4);
  line(p4.x, p4.y, p5.x, p5.y);
  
  fill(255, 0, 0); noStroke(); circle(p4.x, p4.y, 15); // è¦ªæŒ‡å…ˆ
  fill(0, 255, 0); circle(p5.x, p5.y, 15); // åŸºæº–ç‚¹
}

function runGameLoop() {
  frameCountVal++;

  // 1. ã‚¹ã‚¤ãƒ³ã‚°åˆ¤å®šï¼ˆå¯å‹•åŸŸç‡ï¼‰
  let rawRatio = map(thumbDist, distClose, distOpen, 0, 1);
  batSwing = constrain(rawRatio, 0, 1);
  
  // å¯å‹•åŸŸã«ã‚ˆã‚‹ç‹™ã„é«˜ã• (0-0.33:ä¸‹, 0.33-0.66:ä¸­, 0.66-1.0:ä¸Š)
  let aimRow = 0; // 0:Bottom, 1:Mid, 2:Top
  if(batSwing > 0.66) aimRow = 2;
  else if(batSwing > 0.33) aimRow = 1;
  else aimRow = 0;

  // ã‚¬ã‚¤ãƒ‰è¡¨ç¤ºï¼ˆç¾åœ¨ã®ç‹™ã„é«˜ã•ï¼‰
  drawAimGuide(aimRow);

  // 2. ãƒœãƒ¼ãƒ«ç”Ÿæˆ
  if(frameCountVal % 120 === 0) spawnBall();

  // 3. ãƒœãƒ¼ãƒ«æ›´æ–° & å½“ãŸã‚Šåˆ¤å®š
  updateBalls(aimRow);

  // 4. ãƒ‘ãƒãƒ«æç”»
  drawPanels();
}

function drawAimGuide(row) {
  // ç”»é¢ç«¯ã«ç¾åœ¨ã®ãƒ‘ãƒ¯ãƒ¼ãƒ¬ãƒ™ãƒ«ã‚’è¡¨ç¤º
  let barH = height * 0.3;
  let x = isRightHand ? width - 30 : 30;
  
  // èƒŒæ™¯
  fill(50); noStroke(); rect(x-10, height/2 - barH/2, 20, barH);
  
  // ç¾åœ¨åœ°
  let currY = map(batSwing, 0, 1, height/2 + barH/2, height/2 - barH/2);
  fill(0, 255, 255); circle(x, currY, 20);
  
  // åŒºåˆ‡ã‚Šç·š
  stroke(255); strokeWeight(1);
  let y1 = height/2 + barH/6; // 1/3
  let y2 = height/2 - barH/6; // 2/3
  line(x-15, y1, x+15, y1);
  line(x-15, y2, x+15, y2);
}

function spawnBall() {
  // é¸æŠã—ãŸæ‰‹ã¨ã€Œåå¯¾å´ã€ã‹ã‚‰æŠ•ã’ã‚‹
  let startX = isRightHand ? 0 : width;
  let targetX = isRightHand ? width * 0.8 : width * 0.2; // æ‰“ã¤ãƒã‚¤ãƒ³ãƒˆï¼ˆæ‰‹å…ƒä»˜è¿‘ï¼‰
  let y = height * 0.6;
  
  balls.push({
    x: startX, y: y,
    vx: (targetX - startX) / 60, // 60ãƒ•ãƒ¬ãƒ¼ãƒ ã§åˆ°é”
    vy: 0,
    active: true,
    hit: false
  });
}

function updateBalls(currentAimRow) {
  let hitZoneX = isRightHand ? width * 0.8 : width * 0.2;
  
  for(let i=balls.length-1; i>=0; i--) {
    let b = balls[i];
    b.x += b.vx; b.y += b.vy;

    // æç”»
    fill(255); stroke(0); circle(b.x, b.y, 20);

    // å½“ãŸã‚Šåˆ¤å®š (ã‚¿ã‚¤ãƒŸãƒ³ã‚° + è¦ªæŒ‡ãŒé–‹ã„ã¦ã„ã‚‹ã‹)
    // è¦ªæŒ‡ã‚’é–‹ãå‹•ä½œï¼ˆã‚¹ã‚¤ãƒ³ã‚°ï¼‰ã‚’ã—ã¦ã„ã‚‹ã¨ã¿ãªã™é–¾å€¤: 0.2ä»¥ä¸Š
    let isActiveSwing = batSwing > 0.2; 
    let distToZone = abs(b.x - hitZoneX);

    if(!b.hit && b.active && isActiveSwing && distToZone < 40) {
      // ãƒ’ãƒƒãƒˆï¼
      b.hit = true;
      // ç‹™ã£ã¦ã„ã‚‹è¡Œã®ãƒ‘ãƒãƒ«ã¸é£›ã°ã™
      // è¡Œ(0-2)ã®ä¸­ã§ã€ãƒ©ãƒ³ãƒ€ãƒ ãªåˆ—(0-2)ã‚’ç‹™ã†
      let targetRow = currentAimRow;
      let targetCol = floor(random(0, 3));
      
      // ãƒ‘ãƒãƒ«IDç®—å‡º (row0->1,2,3)
      let targetPanelId = (targetRow * 3) + targetCol + 1;
      let targetPanel = panels.find(p => p.id === targetPanelId);

      // ãƒ‘ãƒãƒ«ãŒã‚ã‚Œã°ãã“ã¸ã€ãªã‘ã‚Œã°ãã®æ–¹å‘ã¸
      let tx = targetPanel ? targetPanel.x + targetPanel.w/2 : (isRightHand?0:width);
      let ty = targetPanel ? targetPanel.y + targetPanel.h/2 : 0;
      
      let dx = tx - b.x; let dy = ty - b.y;
      let len = sqrt(dx*dx + dy*dy);
      b.vx = (dx/len) * 30; b.vy = (dy/len) * 30;
    }

    // ãƒ‘ãƒãƒ«æ¥è§¦åˆ¤å®š
    if(b.hit && b.active) {
      for(let p of panels) {
        if(p.active && b.x > p.x && b.x < p.x+p.w && b.y > p.y && b.y < p.y+p.h) {
          p.active = false;
          b.active = false;
          score += 100;
          break;
        }
      }
    }

    // ç”»é¢å¤–ã¸
    if(b.x < -50 || b.x > width+50 || b.y < -50 || b.y > height+50) {
      if(!b.hit && b.active) {
        // ç©ºæŒ¯ã‚Šï¼ˆè¦‹é€ƒã—ï¼‰
        lives--;
        updateLives();
        if(lives <= 0) gameOver();
      }
      balls.splice(i, 1);
    }
  }
}

function drawPanels() {
  for(let p of panels) {
    if(p.active) {
      fill(0, 200, 0, 200); stroke(255); strokeWeight(2);
      rect(p.x, p.y, p.w, p.h, 5);
      fill(255); noStroke(); textAlign(CENTER, CENTER); textSize(24);
      text(p.id, p.x + p.w/2, p.y + p.h/2);
    } else {
      fill(50, 50); stroke(100);
      rect(p.x, p.y, p.w, p.h, 5);
    }
  }
  
  // ã‚¯ãƒªã‚¢åˆ¤å®š
  if(panels.every(p => !p.active)) {
    // å…¨æŠœããƒœãƒ¼ãƒŠã‚¹å¾Œãƒªã‚»ãƒƒãƒˆ
    score += 1000;
    initGame();
  }
}

function updateLives() {
  let h = "";
  for(let i=0; i<3; i++) h += (i < lives ? "â¤ï¸" : "ğŸ’€");
  document.getElementById('life-display').innerHTML = h + `<br><span style="font-size:16px; color:white;">Score: ${score}</span>`;
}

function gameOver() {
  appState = 4;
  document.getElementById('result-score').innerText = `Final Score: ${score}`;
  switchScreen('screen-gameover');
}

// ç”»é¢åˆ‡ã‚Šæ›¿ãˆãƒ˜ãƒ«ãƒ‘ãƒ¼
function switchScreen(id) {
  document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
  if(id) document.getElementById(id).classList.add('active');
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}
</script>
</body>
</html>
