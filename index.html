100æœ¬ãƒãƒƒã‚¯
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Thumb Baseball Professional</title>
  <style>
    body { margin: 0; padding: 0; overflow: hidden; background-color: #000; font-family: sans-serif; }
    canvas { display: block;
            position: absolute; /* ç”»é¢ã«å›ºå®š */
    top: 0;
    left: 0;
}
    #loading {
      position: absolute; top: 0; left: 0; width: 100% !important; height: 100% !important; transform: translate(-50%, -50%);
      color: white; font-size: 20px; text-align: center; text-shadow: 2px 2px 4px #000; pointer-events: none;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/addons/p5.sound.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
</head>
<body>
<div id="loading">ã‚«ãƒ¡ãƒ©èµ·å‹•ä¸­...<br>æ¨ªç”»é¢ã§ã‚¿ãƒƒãƒ—ã—ã¦é–‹å§‹</div>


<script>
let videoElement, hands, camera;
let thumbTip, indexBase, wrist;
let gameState = 1; // 1:èµ¤ç·šè¨­å®š, 2:é’ç·šè¨­å®š, 3:ãƒ—ãƒ¬ã‚¤
let angleClosed = 0, angleOpen = 0, currentAngle = 0; let targetX = 0; 
let balls = [];
let score = 0, combo = 0;
let bgImage, soundHit, soundHomerun, soundFoul;
let message = "", messageTimer = 0, messageColor;
let targetX = 0;//

function preload() {
  //bgImage = loadImage('stadium_bg.png'); 
  //soundHit = loadSound('hit.mp3');
  //soundHomerun = loadSound('homerun.mp3');
  //soundFoul = loadSound('foul.mp3');
}


function setup() {
  createCanvas(windowWidth, windowHeight);
  videoElement = createCapture(VIDEO);
  videoElement.size(width, height);
  videoElement.hide();


  hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
  hands.setOptions({maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5});
  hands.onResults(onResults);


  camera = new Camera(videoElement.elt, {
    onFrame: async () => { await hands.send({image: videoElement.elt}); },
    width: 1280, height: 720
  });
  camera.start();
}


function onResults(results) {currentAngle = p5.Vector.sub(indexBase, wrist).angleBetween(p5.Vector.sub(thumbTip, wrist));
    targetX = thumbTip.x; // â˜…ã“ã‚Œã‚’è¿½åŠ ã—ã¦è¦ªæŒ‡ã®ä½ç½®ã‚’è¨˜éŒ²ã™ã‚‹
  }
  document.getElementById('loading').style.display = 'none';
  if (if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    const lm = results.multiHandLandmarks[0];
    thumbTip = createVector((1 - lm[4].x) * width, lm[4].y * height);
    targetX = thumbTip.x; 
    currentAngle = p5.Vector.sub(indexBase, wrist).angleBetween(p5.Vector.sub(thumbTip, wrist));
  }
}


function touchStarted() {
  if (getAudioContext().state !== 'running') getAudioContext().resume();
  if (thumbTip) {
    if (gameState === 1) { angleClosed = currentAngle; gameState = 2; }
    else if (gameState === 2) { angleOpen = currentAngle; gameState = 3; }
  }
  return false;
}


function draw() {
  if (gameState === 3) {
    //image(bgImage, 0, 0, width, height);
    fill(0, 80); rect(0,0,width,height);
    playGame();
  } else {
    drawCalibrationUI();
  }
}


function drawCalibrationUI(function drawCalibrationUI() {
    // èƒŒæ™¯ã‚’è–„ãè¡¨ç¤ºã—ã¦ã‚«ãƒ¡ãƒ©ã‚’è¦‹ã‚„ã™ãã™ã‚‹// ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’å·¦å³åè»¢ã—ã¦è¡¨ç¤º
    push();
    translate(width, 0);
    scale(-1, 1);
    image(videoElement, 0, 0, width, height);
    pop();

    // â˜…è¿½åŠ ï¼šæ‰‹ã®é…ç½®ã‚¬ã‚¤ãƒ‰ï¼ˆç”»é¢ä¸­å¤®ã«å††ã‹å››è§’ã‚’è¡¨ç¤ºï¼‰
    noFill();
    stroke(255, 255, 0, 150); // é»„è‰²ã®ã‚¬ã‚¤ãƒ‰ç·š
    strokeWeight(5);
    ellipse(width / 2, height / 2, 250, 350); // ç”»é¢ä¸­å¤®ã«ã‚¬ã‚¤ãƒ‰æ 
    fill(0, 150, 0); // æ–‡å­—ã‚’è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ã®å°‘ã—ãã‚‰ã„èƒŒæ™¯
  ã€€//...ãã®å¾Œã®rectã‚„textã¯ä»Šã®ã¾ã¾ã§ok
    noStroke();
    textSize(20);
    text("ã“ã®æ å†…ã«æ‰‹ã‚’ã‹ã–ã—ã¦ãã ã•ã„", width / 2, height / 2 - 220);

  push(); translate(width, 0); scale(-1, 1); image(videoElement, 0, 0, width, height); pop();
  fill(0, 180); rect(0, 0, width, height);
  textAlign(CENTER, CENTER); textSize(30); fill(255);
  if (!thumbTip) { text("æ‰‹ã‚’æ˜ ã—ã¦ãã ã•ã„", width/2, height/2); return; }
  
  if (gameState === 1) {
    stroke(255, 0, 0); strokeWeight(5); line(wrist.x, wrist.y, thumbTip.x, thumbTip.y);
    noStroke(); text("ã€STEP 1ã€‘\nè¦ªæŒ‡ã‚’é–‰ã˜ã¦(èµ¤ç·š)ã‚¿ãƒƒãƒ—", width/2, height/2);
  } else {
    stroke(0, 150, 255); strokeWeight(5); line(wrist.x, wrist.y, thumbTip.x, thumbTip.y);
    noStroke(); text("ã€STEP 2ã€‘\nè¦ªæŒ‡ã‚’å…¨é–‹ã«ã—ã¦(é’ç·š)ã‚¿ãƒƒãƒ—", width/2, height/2);
  }
}


function playGame() {
  let progress = constrain(map(currentAngle, angleClosed, angleOpen, 0, 1), 0, 1);
  let batX = map(progress, 0, 1, width/2 - 150, width/2 + 150);
  let batY = map(progress, 0, 1, height - 100, height - 250);


  // ãƒãƒƒãƒˆæç”»
  push();
  translate(batX, batY);
  rotate(map(progress, 0, 1, -PI/6, PI/6));
  fill(progress > 0.8 ? color(255,0,0) : (progress > 0.1 ? color(255,255,0) : 255));
  rect(-10, 0, 20, 120);
  pop();


  if (frameCount % 60 === 0) balls.push(new Ball());


  for (let i = balls.length - 1; i >= 0; i--) {
    let b = balls[i];
    b.update(); b.display();
    if (!b.isHit && dist(b.x, b.y, batX, batY) < 60) {
      let pct = progress * 100;
      if (pct <= 10) { b.hit("foul"); showMessage("ãƒ•ã‚¡ãƒ¼ãƒ«...", color(200)); combo = 0; }
      else if (pct <= 80) { b.hit("hit"); score++; combo++; if(score%10===0) showMessage("ã‚¤ã‚¤ã˜ã‚ƒã‚“ğŸ‘", color(255,255,0)); }
      else { b.hit("homerun"); score+=5; combo++; showMessage(combo>=50?"æœ€é«˜ã«ã‚¤ã‚¤ã˜ã‚ƒã‚“ğŸ‘":"ãƒ›ãƒ¼ãƒ ãƒ©ãƒ³ï¼", color(255,50,50)); }
    }class Ball {
    constructor() {
        // ç”»é¢å…¨ä½“ã§ã¯ãªãã€è¦ªæŒ‡ãŒã„ã‚‹å‘¨è¾ºï¼ˆå·¦å³100pxä»¥å†…ï¼‰ã‹ã‚‰è½ã¨ã™
        this.x = random(targetX - 100, targetX + 100); 
        this.y = -50;
        this.vx = random(-2, 2);
    this.vy = random(5, 8);
    this.isHit = false;
  }
  
  fill(255); textSize(32); textAlign(LEFT, TOP);
  text(`Score: ${score}\nCombo: ${combo}`, 20, 20);
  if (messageTimer > 0) {
    textAlign(CENTER); fill(messageColor); stroke(0); strokeWeight(4);
    textSize(60); text(message, width/2, height/3); messageTimer--;
  }
}


function showMessage(t, c) { message = t; messageColor = c; messageTimer = 60; }


class Ball {
  constructor() { this.x = random(100, width-100); this.y = -50; this.vx = random(-2,2); this.vy = random(5,8); this.isHit = false; }
  update() { this.x += this.vx; this.y += this.vy; if (this.isHit) this.vy += 0.8; }
  display() { fill(255); ellipse(this.x, this.y, 40); }
  hit(type) {
    this.isHit = true;
    //if (type === "foul") { soundFoul.play(); this.vy = 2; }
    //else if (type === "hit") { soundHit.play(); this.vy = -15; this.vx *= 2; }
    //else { soundHomerun.play(); this.vy = -35; this.vx *= 0.5; }
  }
}
function mousePressed(){console.log("tap ok");}
</script> 
</body>
</html>






